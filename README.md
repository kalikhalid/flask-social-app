## Про приложение

Приложение представляет из себя HTTP сервер, реализующий минимальное API для социальной сети. 

Приложение конфигурируется через переменные окружения:



- `POSTGRES_CONN` &mdash; URL-строка для подключения к PostgreSQL в формате `postgres://{username}:{password}@{host}:{5432}/{dbname}`.


- `RANDOM_SECRET` &mdash; псевдо-случайная последовательность из 128 символов (a-z, A-Z, 0-9), сгенерированная тестирующей системой. Можете использовать её, если вашему приложению необходим секретный ключ (например, для JWT). Если вам не требуется данное значение, можете его не использовать.

Приложение может запускаться через Docker контейнер. В репозитории присутствует Dockerfile, с помощью которого может собираться образ приложения. 

## End-поинты



| Название группы  | Описание                           | От каких групп зависит |
|------------------|------------------------------------|------------------------|
| 01/ping          | Успешный ответ на `/api/ping`.     |                        |
| 02/countries     | Получение и фильтрация стран.      |                        |
| 03/auth/register | Регистрация пользователей.         | - 02/countries         |
| 04/auth/sign-in  | Аутентификация и получение токена. | - 03/auth/register     |
| 05/me  | Получение и редактирование собственного профиля. | - 04/auth/sign-in     |
| 06/profiles  | Получение профиля по логину. | - 04/auth/sign-in     |
| 07/password  | Изменение пароля. | - 05/me     |
| 08/friends  | Друзья! | - 04/auth/sign-in<br>- 06/profiles    |
| 09/posts/publish  | Публикация поста и получение по ID. | - 05/me<br>- 08/friends     |
<!-- | 10/posts/feed  | Получение новостной ленты. | - 09/posts/publish     |
| 11/posts/likes  | Лайки и дизлайки. | - 10/posts/feed     | -->




**У всех эндпоинтов есть префикс `/api`.**


### 02/countries

Как и в любом большом проекте у нас есть собственный словарь стран, который используется при регистрации пользователей и может учитываться рекомендательными системами и системой локализации контента.

Про каждую страну известны следующие данные:
```json
{
    "name": "полное название",
    "alpha2": "двухбуквенный код страны (в верхнем регистре)",
    "alpha3": "трехбуквенный код страны",
    "region": "географический регион"
}
```

Реализованы следующие эндпоинты:

- `GET /countries` &mdash; получить список доступных стран, доступна фильтрация по регионам. 

- `GET /countries/{alpha2}` &mdash; получить страну по её уникальному двухбуквенному коду.

Данные находятся в таблице `countries`, которая имеет следующее определение:
```sql
CREATE TABLE countries (
    id SERIAL PRIMARY KEY,
    name TEXT,
    alpha2 TEXT,
    alpha3 TEXT,
    region TEXT
);

INSERT INTO countries (name, alpha2, alpha3, region) VALUES
    ('Åland Islands','AX','ALA','Europe'),
    ('Albania','AL','ALB','Europe'),
    ...;
```

### 03/auth/register

Эндпоинт `/auth/register` используется для первичной регистрации пользователей. 

### 04/auth/sign-in

Эндпоинт `/auth/sign-in` предназначен для аутентификации пользователя по логину и паролю и генерации сессионного токена, 
который в дальнейшем будет использоваться для генерации запросов.

Генерируемый токен  уникально идентифицирует пользователя и является сложным для подбора (используется JWT).

Данный токен в дальнейшем должен передаваться пользователем в заголовке `Authorization: Bearer {token}`.

### 05/me

Эндпоинт `/me/profile` используется для получения и редактирования параметров собственного профиля пользователя. Действие зависит от указанного метода (`GET` и `PATCH`).

В запросе на редактирование профиля передаются значения только тех полей, которые необходимо обновить.

### 06/profiles

Эндпоинт `/profiles/{login}` позволяет получить профиль другого пользователя по логину.

Обратите внимание, в некоторых ситуациях профиль пользователя получить нельзя (в зависимости от значения параметра `isPublic`). 

### 07/password

С помощью `/me/updatePassword` у пользователя появляется возможность изменить пароль от своего аккаунта.

После изменения пароля:

- Аутентификация со старым паролем становится невозможной.

- Все ранее выпущенные токены будут отозваны. Использование старых токенов становится равнозначным использованию некорректных токенов.

После успешной смены пароля при попытке получить свой профиль со старым токеном пользователь получит ошибку.

### 08/friends

В приложении есть возможность добавлять и удалять других пользователей из списка своих друзей.
И конечно же можно посмотреть список своих друзей.

Свойство быть другом &mdash; одностороннее. Если Петя добавит Машу в друзья, то профиль Пети становится доступным для Маши, даже если у Пети закрытый профиль.

Чтобы не нагружать сервера и клиентов слишком сильно, в запросах на получение списка друзей используется пагинация.
С помощью параметров `offset` и `limit` можно "постранично" получить весь список друзей, запрашивая данные порционно.

Вам потребуется запоминать дату и время последнего добавления в друзья для корректно сортировки и реализации пагинации.

### 09/posts/publish

Затрагиваемые эндпоинты:
- `/posts/new`
- `/posts/{postId}`

Сервер генерирует уникальные идентификаторы и запоминает время создания публикаций.

У пользователя есть доступ к своим постам, постам пользователей с публичным профилем и постам других пользователей, которые добавили данного пользователя в друзья.
